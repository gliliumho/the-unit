<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>The Unit: Slave Unit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="theunit_68_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Unit
   &#160;<span id="projectnumber">v0.5</span>
   </div>
   <div id="projectbrief">Modern railway reflector</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Slave Unit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#slave_description">Description</a></li>
<li class="level1"><a href="#slave_wdid">What does it do?</a></li>
<li class="level1"><a href="#slave_architecture">Architecture</a><ul><li class="level2"><a href="#slave_algorithm">Algorithm?</a></li>
</ul>
</li>
<li class="level1"><a href="#slave_suggestions">Future Improvement &amp; Suggestions</a></li>
</ul>
</div>
<div class="textblock"><p>**</p>
<h1><a class="anchor" id="slave_description"></a>
Description</h1>
<p>The slave unit is targeted to be a low cost and low-powered wireless device to be mass deployed alone the highway. The device will be self-sustained using solar and battery.</p>
<p>Slave units will also have LED strips to display traffic info for the road ahead. Currently the slave will receive traffic info from master unit, which will receive its traffic data from traffic servers (currently supports RecoTraffic).</p>
<p>You probably read everything you need to know from the introduction already. So to sum it all up, the slave unit is targeted to be:</p><ul>
<li>low-powered</li>
<li>low cost (cheappppppppp like &lt;RM120)</li>
<li>self-sustained (solar + battery)</li>
<li>low-maintenance</li>
<li>can be mass-deployed</li>
<li>LEDs are bright enough to see from 50m</li>
<li>can integrate sensor in the future</li>
<li>no need to lay infrastructures (hence, RF communications)</li>
</ul>
<h1><a class="anchor" id="slave_wdid"></a>
What does it do?</h1>
<p>It displays traffic info / congestion level at the road ahead. That is what it does from the outside. On the inside, it's a communication device. When sensors are implemented, it'll be a data mining device.</p>
<p>Still, it'll be a slave to us.</p>
<h1><a class="anchor" id="slave_architecture"></a>
Architecture</h1>
<p>One master as gateway to rule them all. Slave units are both repeater and node. The slave units will need to be in range of one another, forming a long chain. Redundancy is factored in so it's okay to overlap slave units.</p>
<p>For now, traffic info for all groups (currently supports up to 28 groups) are re-transmitted. In layman analogy, the chain of slaves would be a line of people. Then you pass them a sheet of information. They look at it, then pass it behind. Slave units are like that for traffic info. Slave units take a look inside the packet for the information they need, then retransmit it.</p>
<p>Heartbeat is only transmitted upon request. The master unit will have to request for heartbeat from slave unit of specific ID to get it. If you want heartbeat from slave 2.7, master unit will need to request heartbeat from that specific ID. If you've a slave 23.40 that you forgot about, it'll probably be forgotten, much like how you don't know every IP address in a large network (well...there are ways you can know the list of IP addresses alive but that's another topic).</p>
<p>When master unit transmits heartbeat request, the request will be passed along the slave units until it reaches the intended slave unit. That slave unit will generate a heartbeat reply and transmit it. Then the rest of the slave units will pass the heartbeat reply along back to master.</p>
<p>Slave units will not retransmit any packet intended for slave of smaller groupID. If you have a heartbeat request for (or heartbeat reply from) Slave 6.8, Slave 7.x and higher will not retransmit the packet.</p>
<p>It hasn't been tested extensively (and more importantly, massively scaled), so we're still not entirely sure how well the slave units perform under load.</p>
<h2><a class="anchor" id="slave_algorithm"></a>
Algorithm?</h2>
<p>I think I explained the overall algorithm in the architecture good enough. Below is a flow diagram for the algorithm for easier understanding. </p><div class="image">
<img src="./assets/multihop_algorithm.png" alt="multihop_algorithm.png"/>
<div class="caption">
Slave unit flow diagram</div></div>
 <h1><a class="anchor" id="slave_suggestions"></a>
Future Improvement &amp; Suggestions</h1>
<ul>
<li>Fully support traffic info for all groups by adding a new packet type. Maybe use header of 0x04 for the new packet type to specify traffic info for group X. You've probably use first 3 or 4 bytes of the packet, so rest of the packet can be used for any other information you wanna transmit.</li>
<li>Implement i2c. You can use GPIO to emulate an i2c. I've already implemented half the functions. This will be needed to interface with some sensors that use i2c only.</li>
<li>New packet type that allows data to be split across multiple packets (then rejoin in master unit). That way we can do away with the 16/32 byte limit. Maximum supported packet size is 32 bytes for NRF9E5 but we're currently using 16 bytes only. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
