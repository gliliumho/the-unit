<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>The Unit: b. slaveRF</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="theunit_68_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Unit
   &#160;<span id="projectnumber">v0.5</span>
   </div>
   <div id="projectbrief">Modern railway reflector</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">b. slaveRF<div class="ingroups"><a class="el" href="group__radio.html">3. Radio</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Function declarations for slaveRF.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga014fb843bf90861f96e00cbfedea6f80"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#ga014fb843bf90861f96e00cbfedea6f80">SlaveOp_Buffer</a> (unsigned char gid, unsigned char uid)</td></tr>
<tr class="memdesc:ga014fb843bf90861f96e00cbfedea6f80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this function to do slave unit stuff.  <a href="#ga014fb843bf90861f96e00cbfedea6f80">More...</a><br /></td></tr>
<tr class="separator:ga014fb843bf90861f96e00cbfedea6f80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga96d323766c56cba8f0ba6b0e44cdd899"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#ga96d323766c56cba8f0ba6b0e44cdd899">SlaveReceive</a> (unsigned char b[<a class="el" href="group__radio.html#gaebdc7d8ca8e25ed8efc90bb88ef7ef5b">PACKET_SIZE</a>])</td></tr>
<tr class="memdesc:ga96d323766c56cba8f0ba6b0e44cdd899"><td class="mdescLeft">&#160;</td><td class="mdescRight">Basically <a class="el" href="group__radio.html#gaa269a7aecf39f454d07ca60f7967a8f5" title="Receive packet through RF. ">ReceivePacket()</a> with timeout.  <a href="#ga96d323766c56cba8f0ba6b0e44cdd899">More...</a><br /></td></tr>
<tr class="separator:ga96d323766c56cba8f0ba6b0e44cdd899"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga56dd2b2a700ec6dc068cf3f9332e91b3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#ga56dd2b2a700ec6dc068cf3f9332e91b3">CheckTraffic</a> (unsigned char b[<a class="el" href="group__radio.html#gaebdc7d8ca8e25ed8efc90bb88ef7ef5b">PACKET_SIZE</a>], unsigned char gid)</td></tr>
<tr class="memdesc:ga56dd2b2a700ec6dc068cf3f9332e91b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check packet and respond to the traffic info.  <a href="#ga56dd2b2a700ec6dc068cf3f9332e91b3">More...</a><br /></td></tr>
<tr class="separator:ga56dd2b2a700ec6dc068cf3f9332e91b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacfedbf1611b5c8f5d93a5abc268d655a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#gacfedbf1611b5c8f5d93a5abc268d655a">SendHeartbeat</a> (unsigned char gid, unsigned char uid)</td></tr>
<tr class="memdesc:gacfedbf1611b5c8f5d93a5abc268d655a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a heartbeat reply.  <a href="#gacfedbf1611b5c8f5d93a5abc268d655a">More...</a><br /></td></tr>
<tr class="separator:gacfedbf1611b5c8f5d93a5abc268d655a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaabe0c4846ca2181e20b882380dede629"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#gaabe0c4846ca2181e20b882380dede629">SlaveRelay</a> (unsigned char b[<a class="el" href="group__radio.html#gaebdc7d8ca8e25ed8efc90bb88ef7ef5b">PACKET_SIZE</a>])</td></tr>
<tr class="memdesc:gaabe0c4846ca2181e20b882380dede629"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retransmit the received packet.  <a href="#gaabe0c4846ca2181e20b882380dede629">More...</a><br /></td></tr>
<tr class="separator:gaabe0c4846ca2181e20b882380dede629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ca9ad18f44878d8df85ca928a85fb8c"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__radio__slave.html#ga3ca9ad18f44878d8df85ca928a85fb8c">CheckBuffer</a> (<a class="el" href="structpacket_i_d.html">packetID</a> a)</td></tr>
<tr class="memdesc:ga3ca9ad18f44878d8df85ca928a85fb8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if packet has been re-transmitted.  <a href="#ga3ca9ad18f44878d8df85ca928a85fb8c">More...</a><br /></td></tr>
<tr class="separator:ga3ca9ad18f44878d8df85ca928a85fb8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Function declarations for slaveRF. </p>
<p>These functions are only called by slaveRF. Most probably never needed for anything else. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga014fb843bf90861f96e00cbfedea6f80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SlaveOp_Buffer </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>uid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call this function to do slave unit stuff. </p>
<p>This is the heart and soul of the slave units. It listens for packet and when it gets one, it'll check the content of the packet. If the packet is for traffic info, it'll call CheckTraffic to change the LED lights. If it's heartbeat request, it'll reply with a heartbeat. Else, if it's a relevant packet for other slave units (traffic info or slave request but different groupID/uniqueID), it'll relay the message by retransmitting the received packet.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gid</td><td>- groupID of the slave unit (the one calling this function) </td></tr>
    <tr><td class="paramname">uid</td><td>- uniqueID of the slave unit (the one calling this function) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga96d323766c56cba8f0ba6b0e44cdd899"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char SlaveReceive </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>b</em>[PACKET_SIZE]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Basically <a class="el" href="group__radio.html#gaa269a7aecf39f454d07ca60f7967a8f5" title="Receive packet through RF. ">ReceivePacket()</a> with timeout. </p>
<p>Yep. It tried to wait for a packet and if none is received, it'll time out and let the slave unit do something else more useful.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b[]</td><td>- array for it to store the received packet </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 if no packet is received</li>
<li>1 if packet received before timeout </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="ga56dd2b2a700ec6dc068cf3f9332e91b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CheckTraffic </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>b</em>[PACKET_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>gid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check packet and respond to the traffic info. </p>
<p>This function is called after <a class="el" href="group__radio__slave.html#ga014fb843bf90861f96e00cbfedea6f80" title="Call this function to do slave unit stuff. ">SlaveOp_Buffer()</a> if the first byte in received packet is TRAFFIC_INFO_HEADER. Then it will turn on the LED depending on the traffic info meant for slave's group.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b[]</td><td>- array for it to store the received packet </td></tr>
    <tr><td class="paramname">gid</td><td>- groupID of the slave unit </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gacfedbf1611b5c8f5d93a5abc268d655a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SendHeartbeat </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>uid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a heartbeat reply. </p>
<p>Called by <a class="el" href="group__radio__slave.html#ga014fb843bf90861f96e00cbfedea6f80" title="Call this function to do slave unit stuff. ">SlaveOp_Buffer()</a> if the first byte in received packet is HEARTBEAT_REQUEST_HEADER. It will transmit/send a packet back with HEARTBEAT_REPLY_HEADER as the first byte to indicate that the slave is alive.</p>
<dl class="section note"><dt>Note</dt><dd>In the future, the sensor data can be included in heartbeat since it only use the first 4 bytes of the 16-byte packet. The rest 12 bytes can be used to store the sensor data.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gid</td><td>- groupID of the slave unit (the one calling this function) </td></tr>
    <tr><td class="paramname">uid</td><td>- uniqueID of the slave unit (the one calling this function) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaabe0c4846ca2181e20b882380dede629"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SlaveRelay </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>b</em>[PACKET_SIZE]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retransmit the received packet. </p>
<p>This function is called when it receives any packet that is meant to be relayed.</p>
<p>First, it determines if the packet received has been re-transmitted already or not. If it has been re-transmitted, then there is no point of transmitting again. Retransmitting will possibly cause other slaves to retransmit too, causing the same packet to be 'echoed' around forever.</p>
<p>The packets it will retransmit are the packets that is needed by other slave units. For eg. heartbeat request for (gid=50, uid=32) but the current slave is (gid=10, uid=40), then it'll relay the packet.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b[]</td><td>- packet to be re-transmitted </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga3ca9ad18f44878d8df85ca928a85fb8c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char CheckBuffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structpacket_i_d.html">packetID</a>&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if packet has been re-transmitted. </p>
<p>It will check the <code><a class="el" href="structpacket_i_d.html" title="stuct to track each packet ">packetID</a></code> and determine if it has been re-transmitted through <a class="el" href="group__radio__slave.html#gaabe0c4846ca2181e20b882380dede629" title="Retransmit the received packet. ">SlaveRelay()</a>. If yes, the <code><a class="el" href="structpacket_i_d.html" title="stuct to track each packet ">packetID</a></code> will be in the <code>id_buffer</code> array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>- <code><a class="el" href="structpacket_i_d.html" title="stuct to track each packet ">packetID</a></code> of the packet to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>1 if it has is in <code>id_buffer</code></li>
<li>0 if <code><a class="el" href="structpacket_i_d.html" title="stuct to track each packet ">packetID</a></code> not in <code>id_buffer</code> </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
