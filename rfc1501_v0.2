The Unit Working Group
RFC: 1501

Transmission of RF Packets over 433MHz Networks

Table of Contents
1. Introduction
2. 433MHz Mode for nRF9E5
3. Addressing Mode
4. Maximum Transmission Unit
5. RF Adaptation Layer and Frame Format
5.1.	Dispatch Type and Header
5.2.1.	Traffic Info Header
5.2.2	Traffic Info Payload
6. Unicast Address Mapping (UL)
7. Multicast Address Mapping (DL)
8. Frame Delivery in a Link Layer
9. Security Considerations
10. Acknowlegdements
11. References


Introduction

The 433MHz frequency band targets far distance communication. This document defines the frame format for transmission of RF packets as well as the downlink (DL) and uplink (UL) communication between RF master and RF slaves.

5. RF Adaptation Layer and Frame Format

The payload of nRF9E5 is constrained to 32 bytes. However to reduce transmission power, we limit the maximum payload size to 16 bytes in this version.

			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Dispatch 	|	Type Header	|								+
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+							   -+
|																|
+-															   -+
|							Payload								|
+-															   -+
|																|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

5.1.	Dispatch Type and Header

The dispatch type is defined by a zero bit as the first bit and a one bit as the second bit. The dispatch type and header are shown here:

			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1|  Dispatch |  Type-specific header							
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Dispatch 				6-bit selector. Identifies the type of header immediately following the Dispatch Header.
Type-specific header	A header determined by the Dispatch Header

			Figure 1: Dispatch Type and Header

  Pattern		Header type
+-----------+-------------------------------------------------------+
| 01 000000 | NULL 				- Not a nRF9E5 frame				|
| 01 000001 | Traffic 			- Downlink traffic information		|
| 01 000010 | Node Info Request	- Uplink Node Info Request			|
| 01 000011 | Node Info Reply	- Uplink Node Info Reply			|
| 01 000100 | Change ID			- Dynamically changing ID of node	|
| 01 000101 | reserved			- Reserved for future use			|
| 	...		| reserved			- Reserved for future use			|
| 01 111111 | reserved			- Reserved for future use			|
+-----------+-------------------------------------------------------+

5.2.1.	Traffic Info Header

The traffic header is defined by 

			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1 0 0 0 0 0 1|  size |										|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

size: 		The 4-bit field encodes the maximum number of group information able to be carried by each packet. Maximum is 2^4 = 16 groups.


			Figure 2: Traffic Info Header

One packet can deliver traffic information to a number of groups Gs where one G >= 1 master, denoted by the set Gs = {1,2,...,G}. For convenience, each group is assumed to be deployed with the same number of slaves.

5.2.2	Traffic Info Payload

			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1 0 0 0 0 0 1|  size   |groupID| devID |	  	resv		    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| LED[1]| LED[2]|												|
+-+-+-+-+-+-+-+-+											   -+
|							  									|
+-														+-+-+-+-+
|														| LED[G]|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

groupID: 	The 4-bit field indicates group ID of source. Total 16 (2^4) groups available.
devID:		The 4-bit field indicates packet label. Each packet will be paired with group ID and device ID (groupID devID).
LED[G]: 	The 4-bit field indicates color of LED.
reserved: 	The 4-bit field reserved for future use.

			Figure 3: Traffic Info Payload
			
Currently, the slaves will forward whatever he receives, including traffic info, heartbeat request and response. However, for the heartbeat response, it only requires uplink transmission. Hence the slaves will check through the group ID so that slave will not broadcast heartbeat response that have a larger group ID.
Next, the slaves will note the tuple (groupID devID) in their buffer, and check if the similar tuple packets have been transmitted recently by checking the devID. For any type of packets, the similar packet will not be broadcast if it has been broadcasted recently.
The Figure 3 shows that maximum groups supported by each packet is 24 groups, calculated by

				Maximum group 	= Total Payload Size * One traffic info costs 4 bits
								= [(Total Packet Size) - (Header Size)] * 2
								= [16B - 4B] * 2
								= 12B * 2 = 24

 Pattern	LED Color
+-------+---------------------------------------+
| 0000	|	NULL				  				|		
| 0001	|	Green		- Traffic smooth	  	|	
| 0010	|	Yellow		- Heavy traffic	    	|	
| 0011	|	Red			- Traffic congested		|
+-------+---------------------------------------+					
	
			Figure 4: LED Value Bit Pattern
			
Slave receives the traffic info packet will read payload only from its group ID. Slave knows its group ID from its EEPROM. After processing the packet, the slave broadcast again the same packet. The consequent slaves are also receiving and retransmitting 


M |------------------------------|
			
			
			
			

5.3.1.	Node Info Request Header

The node info request header is defined by 

			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1 0 0 0 0 1 0|  size   |resv |								|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+





do code for master receives info from the slaves



			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1 0 0 0 0 0 1|  size   |groupID| devID |	  	resv		    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| LED[1]| LED[2]|												|
+-+-+-+-+-+-+-+-+											   -+
|							  									|
+-														+-+-+-+-+
|														| LED[G]|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




































			   1			   2			   3			   4
 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 A B C D E F
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+






